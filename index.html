<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Aeon Quest – BENGR Edition</title>
<style>
html, body {
    margin:0; padding:0;
    width:100%; height:100%;
    overflow:hidden; background:#071021;
    font-family: monospace;
}
#gameContainer { width:100vw; height:100vh; }
button {
    padding:10px 14px; border-radius:6px;
    border:none; background:#1F6FEB; color:white;
    font-weight:700; cursor:pointer; font-size:14px;
}
#menu {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background:linear-gradient(180deg,#071021,#0B1A36);
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    z-index:10;
}
#menu h1 { font-size:48px; color:#9AE66E; margin-bottom:40px; }
#hud {
    position:absolute; top:0; width:100%; height:80px;
    padding:10px; display:flex; align-items:center; gap:12px;
    background:rgba(0,0,0,0.6);
}
#dialog {
    position:absolute; bottom:0; left:0; right:0;
    background: rgba(0,0,0,0.7); padding:10px;
    font-size:16px; min-height:50px;
}
#infoPanel {
    position:absolute; top:90px; right:10px;
    width:140px; background:rgba(0,0,0,0.5);
    padding:8px; border-radius:6px; font-size:14px;
}
#fullscreenBtn {
    position:absolute; top:90px; left:10px;
    padding:6px 12px; font-size:14px; border-radius:6px;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
<div id="gameContainer"></div>

<div id="menu">
<h1>Aeon Quest</h1>
<button id="startBtn">Nová kampaň</button>
</div>

<div id="hud" style="display:none;">
<div id="turnInfo">Tah hráče</div>
<div id="resources" style="margin-left:auto;">Krystaly: 0</div>
</div>

<div id="dialog" style="display:none;">AEON: Vítej, veliteli! Připrav se na epickou výpravu.</div>
<div id="infoPanel" style="display:none;">HP: 100</div>
<button id="fullscreenBtn">Celá obrazovka</button>

<script>
const config = {
    type: Phaser.AUTO,
    parent: 'gameContainer',
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: 0x071021,
    scene: { preload, create, update },
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
    }
};
const game = new Phaser.Game(config);

let hudEl, dialogEl, infoEl, turnInfoEl;
let crystals = 10;
let playerUnits = [], enemyUnits = [], treasures = [];
let turn = "player";

function preload() {
    this.load.image('hero','https://i.imgur.com/H6Q0oQO.png');
    this.load.image('knight','https://i.imgur.com/9X0JxOS.png');
    this.load.image('drone','https://i.imgur.com/lB2N1Gd.png');
    this.load.image('orc','https://i.imgur.com/lB2N1Gd.png');
    this.load.image('boss','https://i.imgur.com/7JrS0UO.png');
    this.load.image('treasure','https://i.imgur.com/2DEy3Xv.png');
    this.load.image('ground','https://i.imgur.com/3fjBqXG.png');
    this.load.audio('click','https://freesound.org/data/previews/522/522299_6743376-lq.mp3');
    this.load.audio('attack','https://freesound.org/data/previews/256/256113_3263906-lq.mp3');
}

function create() {
    const scene = this;
    hudEl = document.getElementById('resources');
    dialogEl = document.getElementById('dialog');
    infoEl = document.getElementById('infoPanel');
    turnInfoEl = document.getElementById('turnInfo');

    document.getElementById('startBtn').onclick = ()=>{
        document.getElementById('menu').style.display='none';
        document.getElementById('hud').style.display='flex';
        document.getElementById('dialog').style.display='block';
        document.getElementById('infoPanel').style.display='block';
        startGame(scene);
    };

    document.getElementById('fullscreenBtn').onclick = () => {
        if (scene.scale.isFullscreen) scene.scale.stopFullscreen();
        else scene.scale.startFullscreen();
    };
}

function startGame(scene){
    scene.add.tileSprite(scene.scale.width/2, scene.scale.height/2, scene.scale.width, scene.scale.height, 'ground');

    crystals = 10;
    updateHUD();

    // Poklady
    let nodes = [
        {x:scene.scale.width*0.25, y:scene.scale.height*0.3},
        {x:scene.scale.width*0.5, y:scene.scale.height*0.5},
        {x:scene.scale.width*0.75, y:scene.scale.height*0.35},
        {x:scene.scale.width*0.6, y:scene.scale.height*0.7}
    ];
    for(let n of nodes){
        treasures.push(scene.add.image(n.x,n.y,'treasure').setScale(0.5));
    }

    // Hráčské jednotky
    playerUnits.push({sprite:scene.add.image(100,scene.scale.height/2,'hero').setScale(0.6), hp:100, name:"Hrdina"});
    playerUnits.push({sprite:scene.add.image(100,scene.scale.height/2+80,'knight').setScale(0.5), hp:120, name:"Rytíř"});
    playerUnits.push({sprite:scene.add.image(100,scene.scale.height/2-80,'drone').setScale(0.4), hp:80, name:"Dron"});

    // Nepřátelé
    enemyUnits.push({sprite:scene.add.image(scene.scale.width-150,scene.scale.height/2,'orc').setScale(0.5), hp:90});
    enemyUnits.push({sprite:scene.add.image(scene.scale.width-150,scene.scale.height/2+100,'orc').setScale(0.5), hp:100});
    enemyUnits.push({sprite:scene.add.image(scene.scale.width-150,scene.scale.height/2-100,'boss').setScale(0.7), hp:180});

    dialog("AEON: Sbírej poklady, vylepšuj jednotky a poraz nepřátele.");

    // Tap pro pohyb a sběr pokladů / útok
    scene.input.on('pointerdown', function(pointer){
        if(turn!=="player") return;
        const px = pointer.worldX, py = pointer.worldY;
        let selected = playerUnits[0]; // Hrdina
        scene.tweens.add({
            targets:selected.sprite,
            x:px, y:py,
            duration:600,
            onComplete:()=>{checkTreasure(selected,scene);}
        });
        turn="enemy";
        turnInfoEl.innerText="Tah nepřítele";
        setTimeout(()=>enemyTurn(scene),800);
    });
}

function updateHUD(){
    hudEl.innerText="Krystaly: "+crystals;
}

function dialog(text){
    dialogEl.innerText=text;
    setTimeout(()=>{dialogEl.innerText="AEON sleduje situaci..."},4000);
}

function checkTreasure(unit,scene){
    for(let t of treasures){
        if(t.visible && Phaser.Math.Distance.Between(unit.sprite.x,unit.sprite.y,t.x,t.y)<50){
            t.setVisible(false);
            crystals+=5;
            updateHUD();
            dialog("Poklad nalezen! Krystaly +5");
        }
    }
}

function enemyTurn(scene){
    for(let e of enemyUnits){
        const target = playerUnits[Math.floor(Math.random()*playerUnits.length)];
        scene.tweens.add({targets:e.sprite, x:target.sprite.x, y:target.sprite.y, duration:500});
    }
    setTimeout(()=>{turn="player"; turnInfoEl.innerText="Tah hráče";},700);
}

function update(){}
</script>
</body>
</html>
